// =========================
//  Datasource & Generator
// =========================
generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =========================
//        MODELS
// =========================

// ---------- Users ----------
model Users {
  id                  Int       @id @default(autoincrement())
  name                String
  username            String
  email               String    @unique
  password            String
  activeThemeId       Int       @default(1)
  budgetingPercentage Int       @default(0)
  coin                Int       @default(0)
  streak              Int       @default(0)
  lastStreakDate      DateTime?
  highestStreak       Int       @default(0)

  // Relations
  activeTheme Themes? @relation("ActiveTheme", fields: [activeThemeId], references: [id])
  pockets     Pockets[]
  levels      Levels[]
  userThemes  User_Themes[]

  @@map("Users")
}

// ---------- Pockets ----------
model Pockets {
  id        Int     @id @default(autoincrement())
  name      String
  total     Float   @default(0)
  walletType String
  isActive  Boolean @default(true)
  userId    Int

  // Relations
  user              Users        @relation(fields: [userId], references: [id])
  transactionsFrom  Transactions[] @relation("TransactionFrom")
  transactionsTo    Transactions[] @relation("TransactionTo")

  @@map("Pockets")
}

// ---------- Transactions ----------
model Transactions {
  id          Int      @id @default(autoincrement())
  date        DateTime
  name        String
  pricePerUnit Float
  action      String    // Buy / Sell / In / Out
  nominal     Float
  unitAmount  Float

  pocketId    Int
  toPocketId  Int?

  // Relations
  pocket   Pockets @relation("TransactionFrom", fields: [pocketId], references: [id])
  toPocket Pockets? @relation("TransactionTo", fields: [toPocketId], references: [id])

  @@map("Transactions")
}

// ---------- Levels ----------
model Levels {
  id          Int     @id @default(autoincrement())
  name        String
  isCompleted Boolean @default(false)
  userId      Int

  // Relations
  user      Users      @relation(fields: [userId], references: [id])
  questions Questions[]

  @@map("Levels")
}

// ---------- Questions ----------
model Questions {
  id       Int     @id @default(autoincrement())
  question String
  option1  String
  option2  String
  option3  String
  option4  String
  answer   String

  levelId  Int

  // Relations
  level Levels @relation(fields: [levelId], references: [id])

  @@map("Questions")
}

// ---------- Themes ----------
model Themes {
  id            Int      @id @default(autoincrement())
  price         Int      @default(0)
  colors        Json
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user_Themes   User_Themes[] 
  activeUsers   Users[]       @relation("ActiveTheme")

  @@map("themes")
}

// ---------- User_Themes ----------
model User_Themes {
  id       Int  @id @default(autoincrement())
  userId   Int
  themeId  Int
  unlocked Boolean @default(false)

  // Relations
  user  Users  @relation(fields: [userId], references: [id])
  theme Themes @relation(fields: [themeId], references: [id])

  @@map("User_Themes")
}
